var wmAutoTrack=function(t){var t=t||{};this.trackDownlodsAsEvents=t.trackDownlodsAsEvents||!1,this.trackDownloadsWithPath=t.trackDownloadsWithPath||!1,this.pathPageDownloads=t.pathPageDownloads||"Download",this.pathEventDownloads=t.pathEventDownloads||"Download",this.milestoneDownloads=t.milestoneDownloads||"Download",this.trackExternalLinksAsEvents=t.trackExternalLinksAsEvents||!1,this.trackExternalLinksWithPath=t.trackExternalLinksWithPath||!1,this.trackExternalLinksFullUrl=t.trackExternalLinksFullUrl||!1,this.pathPageExternalLinks=t.pathPageExternalLinks||"ExternalLink",this.pathEventExternalLinks=t.pathEventExternalLinks||"ExternalLink",this.milestoneExternalLinks=t.milestoneExternalLinks||"",this.trackMailtoWithPath=t.trackMailtoWithPath||!1,this.trackMailLinkAsEvents=t.trackMailLinkAsEvents||!1,this.pathPageMailto=t.pathPageMailto||"mailto",this.pathEventMailto=t.pathEventMailto||"mailto",this.milestoneMailto=t.milestoneMailto||"",this.debug=t.debug||!1,this._pageSeparator="|",this._groupSeparator="/",this._eventSeparator="/",this._milestoneSeparator="/",this._extensions=/\.(pdf|txt|doc|docx|xls|xlsx|ppt|pptx|js|vsd|vxd|css|rar|zip|tar|gz|dmg|exe|wma|mov|avi|wmv|mp3|mp4|vcf)$/i,this.revertChangedValues=t.revertChangedValues||!0,this._mailto="mailto",this._download="download",this._extlink="extlink";var a=this;this.init=function(){for(var t=document.getElementsByTagName("a"),e=window.location.hostname,n=0;n<t.length;n++){var i=t[n];try{var r=i.hostname;a.isMailTo(i)===!0?a.addMailToListener(i):a.compareDomains(r,e)?a.addDownloadListener(i):a.addExternalLinkListener(i)}catch(s){a.writeLog("Tracking error: "+s)}}},this.isMailTo=function(t){return null!==t.href.match(/^mailto:/i)},this.addMailToListener=function(t){var e=t.href;a.writeLog("Tracking "+e+" as MailTo");var n=e.split("mailto:"),i=n[1],r="mailto";a.addListener(t,function(t,e){return function(){a.writeLog("mailto click"),a.wiredmindsTrack(function(){a.wiredmindsTrackAction(a.trackMailLinkAsEvents,a.trackMailtoWithPath,a.pathPageMailto,a.pathEventMailto,a.milestoneMailto,e)})}}(r,i))},this.addDownloadListener=function(t){var e=t.href,n=t.pathname;if(n.match(this._extensions)){a.writeLog("Tracking "+e+" as DOC");var i="/"+n,r=i.split("/"),s=r[r.length-1],o="download";a.addListener(t,function(t,e){return function(){a.writeLog("file click"),a.wiredmindsTrackAction(a.trackDownlodsAsEvents,a.trackDownloadsWithPath,a.pathPageDownloads,a.pathEventDownloads,a.milestoneDownloads,e)}}(o,s))}},this.addExternalLinkListener=function(t){var e=t.href,n=t.hostname;this.writeLog("Tracking "+e+" as EXTLINK");var i=n;a.trackExternalLinksFullUrl===!0&&(i=e);var r="extlink";a.addListener(t,function(t,e){return function(){a.writeLog("external link click"),a.wiredmindsTrackAction(a.trackExternalLinksAsEvents,a.trackExternalLinksWithPath,a.pathPageExternalLinks,a.pathEventExternalLinks,a.milestoneExternalLinks,e)}}(r,i))},this.addListener=function(t,a){t.addEventListener?t.addEventListener("mousedown",a,!0):t.attachEvent&&t.attachEvent("onmousedown",a)},this.wiredmindsTrack=function(t){if("undefined"!=typeof wiredminds){if(a.revertChangedValues===!0)try{if("function"==typeof wiredminds.getTrackParam)var e=wiredminds.getTrackParam("wm_page_name"),n=wiredminds.getTrackParam("wm_milestone");else a.writeLog("Unable to fetch original values for reset, disabling revert."),a.revertChangedValues=!1}catch(i){a.writeLog("Unable to fetch original values for reset, disabling revert."),a.revertChangedValues=!1}t(),a.revertChangedValues===!0&&(wiredminds.push(["setTrackParam","wm_page_name",e]),wiredminds.push(["setTrackParam","wm_milestone",n]))}},this.wiredmindsTrackAction=function(t,e,n,i,r,s){if(t===!0){var o=[i,s].join(a._eventSeparator);wiredminds.push(["trackEvent",o])}else if(""!==r&&wiredminds.push(["setTrackParam","wm_milestone",r]),e===!0)wiredminds.push(["count",s]);else{var l=[n,s].join(a._pageSeparator);wiredminds.push(["setTrackParam","wm_page_name",l]),wiredminds.push(["count"])}},this.compareDomains=function(t,e){return a.getDomain(t)==a.getDomain(e)},this.getDomain=function(t){var a=t.lastIndexOf(".");a=t.lastIndexOf(".",a-1);var e=t.substring(a+1);return e},this.writeLog=function(t){1==a.debug&&console&&console.log(t)}};